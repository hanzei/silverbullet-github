{
  "name": "github",
  "functions": {
    "queryEvents": {
      "events": [
        "query:gh-event"
      ],
      "code": "(() => { var mod=(()=>{var A=Object.create;var u=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var O=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var d=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var S=(e,t)=>{for(var r in t)u(e,r,{get:t[r],enumerable:!0})},h=(e,t,r,i)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let n of C(t))!$.call(e,n)&&n!==r&&u(e,n,{get:()=>t[n],enumerable:!(i=M(t,n))||i.enumerable});return e};var m=(e,t,r)=>(r=e!=null?A(O(e)):{},h(t||!e||!e.__esModule?u(r,\"default\",{value:e,enumerable:!0}):r,e)),R=e=>h(u({},\"__esModule\",{value:!0}),e);var Y={};S(Y,{default:()=>H});function g(e,t){if(t(e))return[e];let r=[];if(e.children)for(let i of e.children)r=[...r,...g(i,t)];return r}function y(e,t){return g(e,r=>r.type===t)[0]}function x(e,t){g(e,t)}var j=m(d(\"handlebars\")),L=m(d(\"yaml\"));typeof self>\"u\"&&(self={syscall:(e,...t)=>{throw new Error(\"Not implemented here\")}});var p=self.syscall;async function P(e){return p(\"space.readPage\",e)}function T(e,t){let r=[];if(e.filter.length===0)r=t.slice();else{e:for(let i of t){let n=i;for(let{op:o,prop:a,value:s}of e.filter)switch(o){case\"=\":let l=n[a];if(Array.isArray(l)&&!Array.isArray(s)){if(!l.includes(s))continue e}else if(Array.isArray(l)&&Array.isArray(s)){if(!l.some(f=>s.includes(f)))continue e}else if(l!=s)continue e;break;case\"!=\":if(n[a]==s)continue e;break;case\"<\":if(!(n[a]<s))continue e;break;case\"<=\":if(!(n[a]<=s))continue e;break;case\">\":if(!(n[a]>s))continue e;break;case\">=\":if(!(n[a]>=s))continue e;break;case\"=~\":if(!new RegExp(s).exec(n[a]))continue e;break;case\"!=~\":if(new RegExp(s).exec(n[a]))continue e;break;case\"in\":if(!s.includes(n[a]))continue e;break}r.push(n)}}return e.orderBy&&(r=r.sort((i,n)=>{let o=e.orderBy,a=e.orderDesc;return i[o]===n[o]?0:i[o]<n[o]?a?1:-1:a?-1:1})),e.limit&&(r=r.slice(0,e.limit)),e.select&&(r=r.map(i=>{let n={};for(let o of e.select)n[o]=i[o];return n})),r}async function w(e){return p(\"markdown.parseMarkdown\",e)}var b=m(d(\"yaml\"));async function E(e,t=[\"yaml\"]){let{text:r}=await P(e),i=await w(r),n={};return x(i,o=>{if(o.type!==\"FencedCode\")return!1;let a=y(o,\"CodeInfo\");if(!a||!t.includes(a.children[0].text))return!1;let s=y(o,\"CodeText\");if(!s)return!1;let l=s.children[0].text;try{n=b.default.parse(l)}catch(f){throw console.error(\"YAML Page parser error\",f),new Error(`YAML Error: ${f.message}`)}return!0}),n}async function k(e){try{let t=await E(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let i of e){let n=t[i];if(n)r.push(n);else throw new Error(`No such secret: ${i}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function D(){try{let[e]=await k([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var c=class{constructor(t){this.token=t}async apiCall(t,r={}){let i=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(i.status!==200)throw new Error(await i.text());return i.json()}async listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}async listPulls(t,r=\"all\",i=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${i}&direction=desc&per_page=100`)}async listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}static async fromConfig(){return new c(await D())}};async function v({query:e}){let t=await c.fromConfig(),r=e.filter.find(o=>o.prop===\"username\");if(!r)throw Error(\"No 'username' filter specified, this is mandatory\");let i=[];if(r.op===\"=\")i=[r.value];else if(r.op===\"in\")i=r.value;else throw new Error(`Unsupported operator ${r.op}`);let n=[];for(let o of await Promise.all(i.map(a=>t.listEvents(a))))n.push(...o);return e.filter.splice(e.filter.indexOf(r),1),T(e,n.map(o=>N(o)))}function N(e,t=\"\"){let r={};for(let[i,n]of Object.entries(e))t&&(i=t+\"_\"+i),n&&typeof n==\"object\"?r={...r,...N(n,i)}:r[i]=n;return r}var H=v;return R(Y);})();\n return mod;})()"
    },
    "queryPulls": {
      "events": [
        "query:gh-pull"
      ],
      "code": "(() => { var mod=(()=>{var A=Object.create;var u=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var O=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var d=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var S=(e,t)=>{for(var r in t)u(e,r,{get:t[r],enumerable:!0})},h=(e,t,r,i)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let n of C(t))!$.call(e,n)&&n!==r&&u(e,n,{get:()=>t[n],enumerable:!(i=M(t,n))||i.enumerable});return e};var m=(e,t,r)=>(r=e!=null?A(O(e)):{},h(t||!e||!e.__esModule?u(r,\"default\",{value:e,enumerable:!0}):r,e)),R=e=>h(u({},\"__esModule\",{value:!0}),e);var Y={};S(Y,{default:()=>H});function g(e,t){if(t(e))return[e];let r=[];if(e.children)for(let i of e.children)r=[...r,...g(i,t)];return r}function y(e,t){return g(e,r=>r.type===t)[0]}function x(e,t){g(e,t)}var j=m(d(\"handlebars\")),L=m(d(\"yaml\"));typeof self>\"u\"&&(self={syscall:(e,...t)=>{throw new Error(\"Not implemented here\")}});var p=self.syscall;async function P(e){return p(\"space.readPage\",e)}function T(e,t){let r=[];if(e.filter.length===0)r=t.slice();else{e:for(let i of t){let n=i;for(let{op:o,prop:a,value:s}of e.filter)switch(o){case\"=\":let l=n[a];if(Array.isArray(l)&&!Array.isArray(s)){if(!l.includes(s))continue e}else if(Array.isArray(l)&&Array.isArray(s)){if(!l.some(f=>s.includes(f)))continue e}else if(l!=s)continue e;break;case\"!=\":if(n[a]==s)continue e;break;case\"<\":if(!(n[a]<s))continue e;break;case\"<=\":if(!(n[a]<=s))continue e;break;case\">\":if(!(n[a]>s))continue e;break;case\">=\":if(!(n[a]>=s))continue e;break;case\"=~\":if(!new RegExp(s).exec(n[a]))continue e;break;case\"!=~\":if(new RegExp(s).exec(n[a]))continue e;break;case\"in\":if(!s.includes(n[a]))continue e;break}r.push(n)}}return e.orderBy&&(r=r.sort((i,n)=>{let o=e.orderBy,a=e.orderDesc;return i[o]===n[o]?0:i[o]<n[o]?a?1:-1:a?-1:1})),e.limit&&(r=r.slice(0,e.limit)),e.select&&(r=r.map(i=>{let n={};for(let o of e.select)n[o]=i[o];return n})),r}async function w(e){return p(\"markdown.parseMarkdown\",e)}var b=m(d(\"yaml\"));async function E(e,t=[\"yaml\"]){let{text:r}=await P(e),i=await w(r),n={};return x(i,o=>{if(o.type!==\"FencedCode\")return!1;let a=y(o,\"CodeInfo\");if(!a||!t.includes(a.children[0].text))return!1;let s=y(o,\"CodeText\");if(!s)return!1;let l=s.children[0].text;try{n=b.default.parse(l)}catch(f){throw console.error(\"YAML Page parser error\",f),new Error(`YAML Error: ${f.message}`)}return!0}),n}async function k(e){try{let t=await E(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let i of e){let n=t[i];if(n)r.push(n);else throw new Error(`No such secret: ${i}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function D(){try{let[e]=await k([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var c=class{constructor(t){this.token=t}async apiCall(t,r={}){let i=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(i.status!==200)throw new Error(await i.text());return i.json()}async listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}async listPulls(t,r=\"all\",i=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${i}&direction=desc&per_page=100`)}async listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}static async fromConfig(){return new c(await D())}};async function v({query:e}){let t=await c.fromConfig(),r=e.filter.find(o=>o.prop===\"repo\");if(!r)throw Error(\"No 'repo' specified, this is mandatory\");e.filter.splice(e.filter.indexOf(r),1);let i=[];if(r.op===\"=\")i=[r.value];else if(r.op===\"in\")i=r.value;else throw new Error(`Unsupported operator ${r.op}`);let n=[];for(let o of await Promise.all(i.map(a=>t.listPulls(a,\"all\",\"updated\"))))n.push(...o);return n=T(e,n.map(o=>N(o))),n}function N(e,t=\"\"){let r={};for(let[i,n]of Object.entries(e))t&&(i=t+\"_\"+i),n&&typeof n==\"object\"?r={...r,...N(n,i)}:r[i]=n;return r}var H=v;return R(Y);})();\n return mod;})()"
    },
    "queryNotifications": {
      "events": [
        "query:gh-notification"
      ],
      "code": "(() => { var mod=(()=>{var A=Object.create;var u=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var O=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var d=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,r)=>(typeof require!=\"undefined\"?require:t)[r]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var S=(e,t)=>{for(var r in t)u(e,r,{get:t[r],enumerable:!0})},h=(e,t,r,i)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let n of C(t))!$.call(e,n)&&n!==r&&u(e,n,{get:()=>t[n],enumerable:!(i=M(t,n))||i.enumerable});return e};var m=(e,t,r)=>(r=e!=null?A(O(e)):{},h(t||!e||!e.__esModule?u(r,\"default\",{value:e,enumerable:!0}):r,e)),R=e=>h(u({},\"__esModule\",{value:!0}),e);var Y={};S(Y,{default:()=>H});function g(e,t){if(t(e))return[e];let r=[];if(e.children)for(let i of e.children)r=[...r,...g(i,t)];return r}function y(e,t){return g(e,r=>r.type===t)[0]}function x(e,t){g(e,t)}var j=m(d(\"handlebars\")),L=m(d(\"yaml\"));typeof self>\"u\"&&(self={syscall:(e,...t)=>{throw new Error(\"Not implemented here\")}});var p=self.syscall;async function P(e){return p(\"space.readPage\",e)}function T(e,t){let r=[];if(e.filter.length===0)r=t.slice();else{e:for(let i of t){let n=i;for(let{op:s,prop:a,value:o}of e.filter)switch(s){case\"=\":let l=n[a];if(Array.isArray(l)&&!Array.isArray(o)){if(!l.includes(o))continue e}else if(Array.isArray(l)&&Array.isArray(o)){if(!l.some(f=>o.includes(f)))continue e}else if(l!=o)continue e;break;case\"!=\":if(n[a]==o)continue e;break;case\"<\":if(!(n[a]<o))continue e;break;case\"<=\":if(!(n[a]<=o))continue e;break;case\">\":if(!(n[a]>o))continue e;break;case\">=\":if(!(n[a]>=o))continue e;break;case\"=~\":if(!new RegExp(o).exec(n[a]))continue e;break;case\"!=~\":if(new RegExp(o).exec(n[a]))continue e;break;case\"in\":if(!o.includes(n[a]))continue e;break}r.push(n)}}return e.orderBy&&(r=r.sort((i,n)=>{let s=e.orderBy,a=e.orderDesc;return i[s]===n[s]?0:i[s]<n[s]?a?1:-1:a?-1:1})),e.limit&&(r=r.slice(0,e.limit)),e.select&&(r=r.map(i=>{let n={};for(let s of e.select)n[s]=i[s];return n})),r}async function w(e){return p(\"markdown.parseMarkdown\",e)}var b=m(d(\"yaml\"));async function E(e,t=[\"yaml\"]){let{text:r}=await P(e),i=await w(r),n={};return x(i,s=>{if(s.type!==\"FencedCode\")return!1;let a=y(s,\"CodeInfo\");if(!a||!t.includes(a.children[0].text))return!1;let o=y(s,\"CodeText\");if(!o)return!1;let l=o.children[0].text;try{n=b.default.parse(l)}catch(f){throw console.error(\"YAML Page parser error\",f),new Error(`YAML Error: ${f.message}`)}return!0}),n}async function k(e){try{let t=await E(\"SECRETS\",[\"yaml\",\"secrets\"]),r=[];for(let i of e){let n=t[i];if(n)r.push(n);else throw new Error(`No such secret: ${i}`)}return r}catch(t){throw t.message===\"Page not found\"?new Error(`No such secret: ${e[0]}`):t}}async function D(){try{let[e]=await k([\"githubToken\"]);return e}catch{console.error(\"No github-config page found, using default config\");return}}var c=class{constructor(t){this.token=t}async apiCall(t,r={}){let i=await fetch(t,{...r,headers:{Authorization:this.token?`token ${this.token}`:void 0}});if(i.status!==200)throw new Error(await i.text());return i.json()}async listEvents(t){return this.apiCall(`https://api.github.com/users/${t}/events?per_page=100`)}async listPulls(t,r=\"all\",i=\"updated\"){return this.apiCall(`https://api.github.com/repos/${t}/pulls?state=${r}&sort=${i}&direction=desc&per_page=100`)}async listNotifications(){return this.apiCall(\"https://api.github.com/notifications?per_page=100\")}static async fromConfig(){return new c(await D())}};async function v({query:e}){let r=await(await c.fromConfig()).listNotifications();return r=T(e,r.map(i=>N(i))),r}function N(e,t=\"\"){let r={};for(let[i,n]of Object.entries(e))t&&(i=t+\"_\"+i),n&&typeof n==\"object\"?r={...r,...N(n,i)}:r[i]=n;return r}var H=v;return R(Y);})();\n return mod;})()"
    }
  }
}